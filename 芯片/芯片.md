## github repo:https://github.com/kid-od/Algorithmn



# 1.算法实现（c语言）

```c
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define TRIALS 200      /* 试验次数（≥100） */
#define MIN_N 3
#define MAX_N 201

/* 芯片状态 */
typedef enum { GOOD = 1, BAD = 0 } ChipState;

/* 随机整数 [a, b] */
static int rand_int(int a, int b) {
    return a + rand() % (b - a + 1);
}

/* 生成一个长度为 n 的芯片数组，确保好芯片数 > 坏芯片数 */
static void gen_chips(ChipState *arr, int n) {
    int min_good = n/2 + 1; /* 好片至少比坏片多 1 */
    int g = rand_int(min_good, n);
    int i;
    for (i = 0; i < g; ++i) arr[i] = GOOD;
    for (; i < n; ++i) arr[i] = BAD;
    /* 打乱顺序 */
    for (i = n-1; i > 0; --i) {
        int j = rand_int(0, i);
        ChipState tmp = arr[i];
        arr[i] = arr[j];
        arr[j] = tmp;
    }
}

/* 模拟单向测试：tester 测被测 target
   模型：GOOD 报真话（返回 target 状态），BAD 总是说谎（返回 !target） */
static ChipState test_one(const ChipState *arr, int tester, int target) {
    if (arr[tester] == GOOD) return arr[target];
    else return (arr[target] == GOOD ? BAD : GOOD);
}

/* 两两配对淘汰 + 最终候选多数投票验证
   返回：0 表示未找到好芯片（或验证失败），1 表示找到（并把 found_index 设为索引）
   tests_used 为总的单向测试调用次数（由外部传入指针累加） */
static int find_good_chip(const ChipState *arr, int n, int *found_index, long *tests_used) {
    /* indices 保存当前“在场”的芯片下标 */
    int *indices = (int *)malloc(sizeof(int) * n);
    if (!indices) return 0;
    int cur = n;
    for (int i = 0; i < n; ++i) indices[i] = i;

    while (cur > 1) {
        int *next = (int *)malloc(sizeof(int) * cur);
        int next_cnt = 0;
        int i = 0;
        while (i + 1 < cur) {
            int a = indices[i];
            int b = indices[i+1];
            /* A 测 B */
            (*tests_used)++;
            ChipState r1 = test_one(arr, a, b);
            /* B 测 A */
            (*tests_used)++;
            ChipState r2 = test_one(arr, b, a);
            if (r1 == GOOD && r2 == GOOD) {
                /* 两者都说对方好，保留 a（任意选择一片） */
                next[next_cnt++] = a;
            }
            /* 否则两者都丢弃 */
            i += 2;
        }
        if (i < cur) {
            /* 奇数剩一片，直接晋级 */
            next[next_cnt++] = indices[i];
        }
        free(indices);
        indices = next;
        cur = next_cnt;
    }

    if (cur == 0) {
        free(indices);
        return 0; /* 理论上不该发生，因为好 > 坏 */
    }

    int candidate = indices[0];
    free(indices);

    /* 验证阶段：所有其他芯片对 candidate 投票（单向测试） */
    int votes_good = 0;
    for (int i = 0; i < n; ++i) {
        if (i == candidate) continue;
        (*tests_used)++;
        ChipState r = test_one(arr, i, candidate);
        if (r == GOOD) votes_good++;
    }

    /* 判定阈值：多数票 */
    /* 由于有 n-1 投票，候选被认定为 good 的条件设为 votes_good >= n/2 */
    if (votes_good >= (n / 2)) {
        *found_index = candidate;
        return 1;
    } else {
        *found_index = -1;
        return 0;
    }
}

int main() {
    srand((unsigned)time(NULL));

    int total_success = 0;
    long total_tests = 0;
    long min_tests = -1, max_tests = -1;
    long tests_arr[TRIALS];
    int ns_sum = 0;
    int goods_sum = 0;

    for (int t = 0; t < TRIALS; ++t) {
        int n = rand_int(MIN_N, MAX_N);
        ChipState *arr = (ChipState *)malloc(sizeof(ChipState) * n);
        if (!arr) {
            fprintf(stderr, "内存分配失败\n");
            return 1;
        }
        gen_chips(arr, n);
        int num_good = 0;
        for (int i = 0; i < n; ++i) if (arr[i] == GOOD) num_good++;

        long tests_used = 0;
        int found_idx = -1;
        int ok = find_good_chip(arr, n, &found_idx, &tests_used);

        int success = 0;
        if (ok && found_idx >= 0 && found_idx < n && arr[found_idx] == GOOD) success = 1;

        total_success += success;
        total_tests += tests_used;
        tests_arr[t] = tests_used;
        if (min_tests < 0 || tests_used < min_tests) min_tests = tests_used;
        if (max_tests < 0 || tests_used > max_tests) max_tests = tests_used;

        ns_sum += n;
        goods_sum += num_good;

        //打印每次试验的简要信息
		printf("Trial %3d: n=%3d, good=%3d, tests=%4ld, found_idx=%3d, success=%d\n",
               t+1, n, num_good, tests_used, found_idx, success);

        free(arr);
    }

    double success_rate = (double)total_success / TRIALS;
    double avg_tests = (double)total_tests / TRIALS;
    double avg_n = (double)ns_sum / TRIALS;
    double avg_good = (double)goods_sum / TRIALS;

    /* 计算中位数 */
    /* 简单排序 tests_arr */
    for (int i = 0; i < TRIALS - 1; ++i) {
        for (int j = i + 1; j < TRIALS; ++j) {
            if (tests_arr[j] < tests_arr[i]) {
                long tmp = tests_arr[i]; tests_arr[i] = tests_arr[j]; tests_arr[j] = tmp;
            }
        }
    }
    double median_tests = (TRIALS % 2 == 1) ? tests_arr[TRIALS/2] : (tests_arr[TRIALS/2 - 1] + tests_arr[TRIALS/2]) / 2.0;

    printf("===== 芯片测试模拟结果 =====\n");
    printf("试验次数 (TRIALS): %d\n", TRIALS);
    printf("成功次数: %d, 成功率: %.4f\n", total_success, success_rate);
    printf("平均测试次数: %.2f, 中位数测试次数: %.2f, 最少: %ld, 最多: %ld\n",
           avg_tests, median_tests, min_tests, max_tests);
    printf("平均 n: %.2f, 平均 good 数: %.2f\n", avg_n, avg_good);
    printf("===========================\n");

    return 0;
}
```





# 2.运行结果

```te
Trial   1: n= 48, good= 32, tests= 111, found_idx=  0, success=1
Trial   2: n=109, good= 81, tests= 272, found_idx=  4, success=1
Trial   3: n=124, good=110, tests= 341, found_idx=  2, success=1
Trial   4: n=102, good= 73, tests= 253, found_idx=  2, success=1
Trial   5: n=181, good= 99, tests= 430, found_idx= 14, success=1
Trial   6: n=168, good=110, tests= 409, found_idx=  0, success=1
Trial   7: n= 39, good= 25, tests=  92, found_idx=  0, success=1
Trial   8: n=140, good=135, tests= 407, found_idx=  0, success=1
Trial   9: n= 27, good= 23, tests=  72, found_idx=  8, success=1
Trial  10: n=152, good=112, tests= 381, found_idx=  2, success=1
Trial  11: n= 28, good= 25, tests=  75, found_idx=  0, success=1
Trial  12: n=180, good=118, tests= 445, found_idx=  4, success=1
Trial  13: n= 63, good= 55, tests= 170, found_idx=  0, success=1
Trial  14: n=155, good=138, tests= 428, found_idx=  0, success=1
Trial  15: n= 28, good= 28, tests=  81, found_idx=  0, success=1
Trial  16: n=137, good=130, tests= 396, found_idx=  0, success=1
Trial  17: n=126, good= 79, tests= 291, found_idx=  4, success=1
Trial  18: n= 60, good= 38, tests= 139, found_idx= 16, success=1
Trial  19: n=144, good=135, tests= 413, found_idx=  0, success=1
Trial  20: n= 33, good= 30, tests=  90, found_idx=  0, success=1
Trial  21: n= 52, good= 47, tests= 143, found_idx=  0, success=1
Trial  22: n=104, good= 83, tests= 271, found_idx=  4, success=1
Trial  23: n= 75, good= 47, tests= 176, found_idx=  0, success=1
Trial  24: n= 74, good= 47, tests= 179, found_idx=  2, success=1
Trial  25: n=181, good=108, tests= 424, found_idx= 24, success=1
Trial  26: n= 15, good= 12, tests=  36, found_idx=  0, success=1
Trial  27: n= 24, good= 14, tests=  55, found_idx=  8, success=1
Trial  28: n=167, good=120, tests= 416, found_idx= 28, success=1
Trial  29: n=129, good=128, tests= 382, found_idx=  0, success=1
Trial  30: n=184, good=158, tests= 503, found_idx=  4, success=1
Trial  31: n= 10, good=  7, tests=  21, found_idx=  4, success=1
Trial  32: n=138, good=134, tests= 403, found_idx=  0, success=1
Trial  33: n= 24, good= 24, tests=  69, found_idx=  0, success=1
Trial  34: n=150, good=144, tests= 435, found_idx=  0, success=1
Trial  35: n=162, good= 88, tests= 385, found_idx= 22, success=1
Trial  36: n=177, good=159, tests= 492, found_idx=  0, success=1
Trial  37: n=169, good=153, tests= 472, found_idx=  2, success=1
Trial  38: n= 73, good= 64, tests= 200, found_idx=  6, success=1
Trial  39: n=104, good= 85, tests= 275, found_idx=  0, success=1
Trial  40: n= 70, good= 67, tests= 201, found_idx=  0, success=1
Trial  41: n=166, good=154, tests= 473, found_idx=  8, success=1
Trial  42: n=110, good= 61, tests= 249, found_idx= 50, success=1
Trial  43: n=100, good= 51, tests= 229, found_idx= 96, success=1
Trial  44: n= 35, good= 35, tests= 102, found_idx=  0, success=1
Trial  45: n=197, good=141, tests= 488, found_idx=  2, success=1
Trial  46: n= 11, good=  7, tests=  22, found_idx=  2, success=1
Trial  47: n= 72, good= 67, tests= 203, found_idx=  0, success=1
Trial  48: n=  3, good=  2, tests=   4, found_idx=  2, success=1
Trial  49: n=149, good=133, tests= 418, found_idx=  0, success=1
Trial  50: n= 34, good= 27, tests=  85, found_idx=  0, success=1
Trial  51: n= 89, good= 46, tests= 206, found_idx= 82, success=1
Trial  52: n= 86, good= 80, tests= 243, found_idx=  0, success=1
Trial  53: n= 49, good= 48, tests= 142, found_idx=  0, success=1
Trial  54: n= 28, good= 21, tests=  69, found_idx= 10, success=1
Trial  55: n=136, good= 78, tests= 309, found_idx=  4, success=1
Trial  56: n=117, good= 79, tests= 290, found_idx=  2, success=1
Trial  57: n= 28, good= 23, tests=  71, found_idx=  0, success=1
Trial  58: n=191, good=134, tests= 484, found_idx=  0, success=1
Trial  59: n= 93, good= 53, tests= 218, found_idx= 14, success=1
Trial  60: n=129, good=109, tests= 348, found_idx=  0, success=1
Trial  61: n= 83, good= 49, tests= 114, found_idx= -1, success=0
Trial  62: n=129, good=107, tests= 342, found_idx=  2, success=1
Trial  63: n= 38, good= 29, tests=  97, found_idx=  0, success=1
Trial  64: n=129, good=126, tests= 378, found_idx=  0, success=1
Trial  65: n=176, good=139, tests= 463, found_idx=  6, success=1
Trial  66: n=171, good=136, tests= 446, found_idx=  6, success=1
Trial  67: n= 44, good= 38, tests= 117, found_idx=  2, success=1
Trial  68: n= 16, good=  9, tests=  33, found_idx= 14, success=1
Trial  69: n=135, good= 87, tests= 330, found_idx=  6, success=1
Trial  70: n= 79, good= 78, tests= 232, found_idx=  0, success=1
Trial  71: n=173, good= 99, tests= 406, found_idx= 14, success=1
Trial  72: n=169, good=120, tests= 418, found_idx=  2, success=1
Trial  73: n=189, good=177, tests= 540, found_idx=  0, success=1
Trial  74: n=184, good=111, tests= 441, found_idx=  0, success=1
Trial  75: n= 60, good= 58, tests= 173, found_idx=  0, success=1
Trial  76: n=165, good=110, tests= 402, found_idx=  0, success=1
Trial  77: n= 59, good= 33, tests= 140, found_idx= 22, success=1
Trial  78: n= 74, good= 48, tests= 175, found_idx=  0, success=1
Trial  79: n=131, good=125, tests= 378, found_idx=  0, success=1
Trial  80: n= 82, good= 44, tests= 110, found_idx= -1, success=0
Trial  81: n=169, good=150, tests= 466, found_idx=  0, success=1
Trial  82: n=191, good=124, tests= 466, found_idx=  0, success=1
Trial  83: n= 48, good= 27, tests= 109, found_idx= 40, success=1
Trial  84: n=152, good= 78, tests= 200, found_idx= -1, success=0
Trial  85: n= 62, good= 54, tests= 167, found_idx=  0, success=1
Trial  86: n=174, good=135, tests= 449, found_idx=  4, success=1
Trial  87: n=148, good=134, tests= 415, found_idx=  0, success=1
Trial  88: n=165, good=100, tests= 390, found_idx=  2, success=1
Trial  89: n= 56, good= 53, tests= 159, found_idx=  0, success=1
Trial  90: n= 55, good= 51, tests= 154, found_idx=  0, success=1
Trial  91: n=117, good=116, tests= 346, found_idx=  0, success=1
Trial  92: n= 75, good= 61, tests= 194, found_idx=  0, success=1
Trial  93: n=147, good=113, tests= 380, found_idx=  2, success=1
Trial  94: n=117, good= 94, tests= 304, found_idx=  2, success=1
Trial  95: n= 79, good= 76, tests= 228, found_idx=  0, success=1
Trial  96: n=119, good= 99, tests= 320, found_idx=  0, success=1
Trial  97: n= 84, good= 67, tests= 221, found_idx=  2, success=1
Trial  98: n=159, good=138, tests= 434, found_idx=  0, success=1
Trial  99: n=185, good=174, tests= 530, found_idx=  0, success=1
Trial 100: n=  4, good=  4, tests=   9, found_idx=  0, success=1
Trial 101: n=162, good=145, tests= 451, found_idx=  4, success=1
Trial 102: n=142, good= 82, tests= 329, found_idx=  0, success=1
Trial 103: n=168, good=113, tests= 409, found_idx=  4, success=1
Trial 104: n=130, good=102, tests= 343, found_idx= 10, success=1
Trial 105: n= 45, good= 33, tests= 110, found_idx=  0, success=1
Trial 106: n=138, good= 71, tests= 327, found_idx=132, success=1
Trial 107: n=192, good= 97, tests= 246, found_idx= -1, success=0
Trial 108: n= 79, good= 55, tests= 196, found_idx=  2, success=1
Trial 109: n=100, good= 80, tests= 261, found_idx=  0, success=1
Trial 110: n=117, good= 99, tests= 312, found_idx=  0, success=1
Trial 111: n=119, good= 71, tests= 280, found_idx= 14, success=1
Trial 112: n=115, good= 98, tests= 312, found_idx=  0, success=1
Trial 113: n=124, good=100, tests= 325, found_idx=  0, success=1
Trial 114: n=122, good= 78, tests= 287, found_idx= 16, success=1
Trial 115: n=185, good=124, tests= 268, found_idx= -1, success=0
Trial 116: n=200, good=122, tests= 473, found_idx=  8, success=1
Trial 117: n=179, good=174, tests= 524, found_idx=  0, success=1
Trial 118: n= 82, good= 54, tests= 197, found_idx= 20, success=1
Trial 119: n= 99, good= 64, tests= 236, found_idx=  2, success=1
Trial 120: n= 94, good= 56, tests= 219, found_idx=  6, success=1
Trial 121: n=182, good=128, tests= 453, found_idx=  6, success=1
Trial 122: n= 65, good= 43, tests= 156, found_idx=  6, success=1
Trial 123: n= 89, good= 54, tests= 212, found_idx= 20, success=1
Trial 124: n=181, good=159, tests= 500, found_idx=  2, success=1
Trial 125: n= 38, good= 24, tests=  85, found_idx=  0, success=1
Trial 126: n=179, good=162, tests= 500, found_idx=  0, success=1
Trial 127: n=159, good= 85, tests= 218, found_idx= -1, success=0
Trial 128: n=127, good=107, tests= 342, found_idx=  0, success=1
Trial 129: n=101, good= 87, tests= 272, found_idx=  0, success=1
Trial 130: n=122, good= 72, tests= 281, found_idx=  4, success=1
Trial 131: n=195, good=145, tests= 494, found_idx=  4, success=1
Trial 132: n=194, good=127, tests= 461, found_idx= 24, success=1
Trial 133: n=  9, good=  9, tests=  24, found_idx=  0, success=1
Trial 134: n=124, good= 72, tests= 285, found_idx= 36, success=1
Trial 135: n= 17, good= 17, tests=  48, found_idx=  0, success=1
Trial 136: n=179, good=121, tests= 260, found_idx= -1, success=0
Trial 137: n=110, good= 71, tests= 267, found_idx=  4, success=1
Trial 138: n= 91, good= 72, tests= 236, found_idx=  4, success=1
Trial 139: n= 51, good= 39, tests= 132, found_idx=  0, success=1
Trial 140: n= 52, good= 30, tests= 121, found_idx= 28, success=1
Trial 141: n= 23, good= 19, tests=  38, found_idx= -1, success=0
Trial 142: n= 14, good= 11, tests=  33, found_idx=  0, success=1
Trial 143: n= 68, good= 46, tests= 163, found_idx=  2, success=1
Trial 144: n= 55, good= 45, tests= 142, found_idx=  0, success=1
Trial 145: n=101, good= 81, tests= 264, found_idx=  0, success=1
Trial 146: n=122, good= 68, tests= 281, found_idx= 90, success=1
Trial 147: n= 67, good= 52, tests= 178, found_idx=  6, success=1
Trial 148: n=116, good=108, tests= 331, found_idx=  0, success=1
Trial 149: n= 99, good= 89, tests= 274, found_idx=  0, success=1
Trial 150: n= 18, good= 11, tests=  43, found_idx= 12, success=1
Trial 151: n= 66, good= 39, tests= 159, found_idx= 36, success=1
Trial 152: n=167, good= 95, tests= 384, found_idx=  6, success=1
Trial 153: n= 99, good= 97, tests= 290, found_idx=  0, success=1
Trial 154: n=156, good=147, tests= 447, found_idx=  2, success=1
Trial 155: n= 32, good= 25, tests=  79, found_idx=  0, success=1
Trial 156: n= 28, good= 18, tests=  63, found_idx= 14, success=1
Trial 157: n= 98, good= 55, tests= 134, found_idx= -1, success=0
Trial 158: n= 61, good= 61, tests= 180, found_idx=  0, success=1
Trial 159: n= 84, good= 61, tests= 207, found_idx=  4, success=1
Trial 160: n=161, good= 95, tests= 222, found_idx= -1, success=0
Trial 161: n= 38, good= 26, tests=  91, found_idx=  8, success=1
Trial 162: n=199, good=134, tests= 492, found_idx= 12, success=1
Trial 163: n=133, good=113, tests= 360, found_idx=  0, success=1
Trial 164: n=166, good=149, tests= 465, found_idx=  0, success=1
Trial 165: n=147, good= 87, tests= 352, found_idx=  4, success=1
Trial 166: n= 33, good= 21, tests=  80, found_idx= 20, success=1
Trial 167: n=178, good=105, tests= 423, found_idx=  0, success=1
Trial 168: n=104, good= 96, tests= 295, found_idx=  0, success=1
Trial 169: n=182, good=137, tests= 465, found_idx=  0, success=1
Trial 170: n=195, good=169, tests= 536, found_idx=  0, success=1
Trial 171: n=129, good= 72, tests= 292, found_idx= 34, success=1
Trial 172: n= 98, good= 64, tests= 142, found_idx= -1, success=0
Trial 173: n= 46, good= 25, tests= 103, found_idx= 16, success=1
Trial 174: n= 45, good= 35, tests= 114, found_idx=  2, success=1
Trial 175: n=145, good=126, tests= 396, found_idx=  0, success=1
Trial 176: n=101, good= 97, tests= 292, found_idx=  0, success=1
Trial 177: n= 19, good= 13, tests=  44, found_idx=  4, success=1
Trial 178: n=100, good= 78, tests= 257, found_idx=  2, success=1
Trial 179: n=176, good=114, tests= 427, found_idx=  6, success=1
Trial 180: n= 30, good= 23, tests=  73, found_idx=  2, success=1
Trial 181: n= 93, good= 72, tests= 242, found_idx=  2, success=1
Trial 182: n= 33, good= 21, tests=  78, found_idx= 18, success=1
Trial 183: n= 15, good= 13, tests=  38, found_idx=  0, success=1
Trial 184: n=  3, good=  3, tests=   6, found_idx=  0, success=1
Trial 185: n= 18, good= 12, tests=  47, found_idx= 12, success=1
Trial 186: n= 16, good= 13, tests=  39, found_idx=  0, success=1
Trial 187: n= 37, good= 27, tests=  90, found_idx=  0, success=1
Trial 188: n= 61, good= 60, tests= 178, found_idx=  0, success=1
Trial 189: n= 93, good= 73, tests= 240, found_idx=  2, success=1
Trial 190: n= 72, good= 69, tests= 207, found_idx=  0, success=1
Trial 191: n=134, good= 83, tests= 309, found_idx=  8, success=1
Trial 192: n= 49, good= 40, tests= 126, found_idx=  0, success=1
Trial 193: n= 25, good= 13, tests=  28, found_idx= -1, success=0
Trial 194: n=158, good=149, tests= 455, found_idx=  0, success=1
Trial 195: n=127, good= 92, tests= 314, found_idx=  0, success=1
Trial 196: n= 52, good= 33, tests=  72, found_idx= -1, success=0
Trial 197: n= 75, good= 49, tests= 182, found_idx= 22, success=1
Trial 198: n=159, good=130, tests= 420, found_idx=  0, success=1
Trial 199: n= 51, good= 36, tests= 122, found_idx=  2, success=1
Trial 200: n=166, good= 95, tests= 395, found_idx=  0, success=1
===== 芯片测试模拟结果 =====
试验次数 (TRIALS): 200
成功次数: 187, 成功率: 0.9350
平均测试次数: 259.07, 中位数测试次数: 258.50, 最少: 4, 最多: 540
平均 n: 103.67, 平均 good 数: 78.08
===========================

[Execution complete with exit code 0]
```



# 3.算法分析

![IMG_814BE50FD33F-1](/Users/entropy/Downloads/Algorithmn/芯片/IMG_814BE50FD33F-1.jpeg)







# 4.学习心得

这个问题是经典的容错/对抗性信息检索问题的一个清爽例子：有限的、可能有恶意（或错误）回答的测量通道中如何用最少测量次数找出真实的“好”对象。它与投票理论、错误纠正、鲁棒统计以及算法设计中的对抗模型密切相关。这个算法像是在举办一个非常严格的面试——只有在同行都互相推荐时，某个候选才被保留；最后再交由多数“同行”来背书。