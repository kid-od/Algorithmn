## **github repo:** https://github.com/kid-od/Algorithmn/tree/main

# 1.算法思路

先用递归将链表不断二分，直到每个子链表只包含一个节点，在递归返回时，每个子链表已经是随机排列的，然后在合并两个子链表时，不再按大小顺序排列，而是每次随机选择左子链表或右子链表的当前节点加入结果链表，选择概率与两边剩余节点数成比例，通过这种方式，整个链表在递归合并完成后就被均匀随机地洗牌，保证每种排列出现的概率相等，同时递归深度为 log n，只使用 O(log n) 的额外空间，整体时间复杂度为 O(n log n)。

# 2.代码

```c
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

typedef struct ListNode {
    int val;
    struct ListNode* next;
} ListNode;

// 获取链表长度
int getLength(ListNode* head) {
    int len = 0;
    while (head) {
        len++;
        head = head->next;
    }
    return len;
}

// 随机选择合并两个子链表
ListNode* shuffleMerge(ListNode* left, int leftSize, ListNode* right, int rightSize) {
    ListNode dummy;
    ListNode* tail = &dummy;
    dummy.next = NULL;

    while (left || right) {
        double p = (double)leftSize / (leftSize + rightSize);
        double r = (double)rand() / RAND_MAX;

        if (left && (!right || r < p)) {
            tail->next = left;
            left = left->next;
            leftSize--;
        } else {
            tail->next = right;
            right = right->next;
            rightSize--;
        }
        tail = tail->next;
    }
    tail->next = NULL;
    return dummy.next;
}

// 主递归函数
ListNode* shuffleList(ListNode* head, int n) {
    if (n <= 1) return head;

    // 找中点
    int mid = n / 2;
    ListNode* midNode = head;
    for (int i = 1; i < mid; i++)
        midNode = midNode->next;

    ListNode* right = midNode->next;
    midNode->next = NULL;

    ListNode* leftShuffled = shuffleList(head, mid);
    ListNode* rightShuffled = shuffleList(right, n - mid);

    return shuffleMerge(leftShuffled, mid, rightShuffled, n - mid);
}

ListNode* shuffleLinkedList(ListNode* head) {
    int n = getLength(head);
    srand((unsigned)time(NULL));
    return shuffleList(head, n);
}
```



# 3.代码结果

![result_1](https://raw.githubusercontent.com/kid-od/Algorithmn/main/洗选列表/result_1.png)

![result_2](https://raw.githubusercontent.com/kid-od/Algorithmn/main/洗选列表/result_2.png)

![result_3](https://raw.githubusercontent.com/kid-od/Algorithmn/main/洗选列表/result_3.png)
